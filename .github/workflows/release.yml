name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Cache Maven packages
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2

    - name: Run tests
      run: mvn clean test

    - name: Build with Maven
      run: mvn clean package -DskipTests

    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.ref_name }}
        name: Release ${{ github.ref_name }}
        draft: false
        prerelease: false
        generate_release_notes: true
        body: |
          ## 🚀 FlowMachine ${{ github.ref_name }}

          A powerful, type-safe state machine library for Java.

          ### 📦 Maven Usage

          Add this dependency to your Maven project:

          ```xml
          <dependency>
              <groupId>com.github.rayenrejeb</groupId>
              <artifactId>flow-machine</artifactId>
              <version>${{ github.ref_name }}</version>
          </dependency>
          ```

          Add JitPack repository:

          ```xml
          <repository>
              <id>jitpack.io</id>
              <url>https://jitpack.io</url>
          </repository>
          ```

          ### 🐘 Gradle Usage

          ```gradle
          repositories {
              maven { url 'https://jitpack.io' }
          }

          dependencies {
              implementation 'com.github.rayenrejeb:flow-machine:${{ github.ref_name }}'
          }
          ```

          ### 📚 Documentation

          - [Quick Start Guide](https://github.com/rayenrejeb/flow-machine/blob/main/QUICK_START.md)
          - [Usage Examples](https://github.com/rayenrejeb/flow-machine/blob/main/USAGE_EXAMPLES.md)
          - [API Reference](https://github.com/rayenrejeb/flow-machine/blob/main/STATEMACHINE_API_REFERENCE.md)

          ### 🛠️ What's Included

          - Type-safe state machine with fluent builder API
          - Final states and auto-transitions
          - Guard conditions and priority-based routing
          - Visual diagram generation (Mermaid & PlantUML)
          - Thread-safe and high-performance
          - Comprehensive test coverage